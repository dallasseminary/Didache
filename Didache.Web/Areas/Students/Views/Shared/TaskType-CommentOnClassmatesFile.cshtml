@model Didache.UserTaskData

@{
	List<InteractionThread> threads = Interactions.GetInteractionThreads(Model.TaskID);
}

@if (threads.Count > 0) {
<div class="task-interactions">
<div class="task-interactions-header">
    <span class="user">Name</span>
    <span class="date">Posted</span>
    <span class="date">Last Reply</span>
    <span class="total-replies">Replies</span>
    <div class="clear"></div>
</div>

@foreach (InteractionThread thread in threads) {
	<div class="task-interaction-thread" id="thread-@thread.ThreadID" data-threadid="@thread.ThreadID">
		<div class="task-interaction-header">
			<span class="user">@(thread.User != null ? thread.User.SecureName : "missing")</span>
			<span class="date">@thread.ThreadDate.ToShortDateString()</span>
			<span class="date">@thread.Posts.Last().PostDate.ToShortDateString()</span>
			<span class="total-replies">@(thread.Posts.Count - 1)</span>
		</div>
		<div class="task-interaction-list" style="display:none;">
			
		@foreach (InteractionPost post in thread.Posts) {
			<div class="task-interaction-post @(post.UserID == thread.UserID ? " thread-starter" : "")" id="post-@post.PostID">
				<div class="user-info">
					@if (post.User != null) {
					<a href="@post.User.ProfileDisplayUrl">
						<img src="@post.User.ProfileImageUrl" />
						<span class="name">@post.User.SecureName</span>
					</a>
	 }
				</div>
				<div class="post-content">
					@Html.Raw(post.PostContentFormatted)
				</div>		
				@if (post.FileID > 0) {	
				<div class="post-file">
					File: <a href="@post.File.FileUrl">@post.File.Filename</a>
				</div>
				}
				<div class="post-date">
					@post.PostDate.ToLocalTime()
				</div>
			</div>	
	  	  
  }
	  
			<div class="add-reply">
				<textarea class="reply-text"></textarea>	
				<span class="add-reply-button"><input type="button" class="reply-button" value="Add reply" /> <a href="javascript:void(0)" class="collapse">Close</a></span>
			</div>	
		    
		</div>

	

	</div>
}
</div>
} else {
	<div class="interactions-none">
	No one has turned in an assignment yet, so there are no posts ready for interaction.
	</div>
}
